#!/bin/bash

DNS_IP=`kubectl get svc kube-dns --namespace=kube-system | grep kube-dns | awk '{print $2}'`
ADVERTISE_IP=`kubectl get svc kong-external | grep kong-external | awk '{print $2}'`

kubectl create secret generic kong \
  --from-literal=dns-resolver=server \
  --from-literal=dns-ip=${DNS_IP} \
  --from-literal=dns-port=53 \
  --from-literal=dnsmasq-port=8053 \
  --from-literal=cluster-ip=0.0.0.0 \
  --from-literal=cluster-port=7946 \
  --from-literal=advertise-ip=${ADVERTISE_IP} \
  --from-literal=advertise-port=7946 \
  --from-literal=database=postgres \
  --from-literal=postgres-host=<%= ENV["POSTGRES_HOST"] %> \
  --from-literal=postgres-port=<%= ENV["POSTGRES_PORT"] %> \
  --from-literal=postgres-database=<%= ENV["POSTGRES_DATABASE"] %> \
  --from-literal=postgres-user=<%= ENV["POSTGRES_USER"] %> \
  --from-literal=postgres-password=<%= ENV["POSTGRES_PASSWORD"] %>
