#!/bin/bash

DNS_IP=`kubectl get svc kube-dns --namespace=kube-system | grep kube-dns | awk '{print $2}'`
ADVERTISE_IP=`kubectl get svc kong-cluster --namespace=kong | grep kong-cluster | awk '{print $2}'`

kubectl create secret generic kong --namespace kong \
  --from-literal=dns-ip=${DNS_IP} \
  --from-literal=cluster-listen=0.0.0.0:7946 \
  --from-literal=cluster-advertise=${ADVERTISE_IP}:7946 \
  --from-literal=postgres-host=<%= ENV["POSTGRES_HOST"] %> \
  --from-literal=postgres-port=<%= ENV["POSTGRES_PORT"] %> \
  --from-literal=postgres-database=<%= ENV["POSTGRES_DATABASE"] %> \
  --from-literal=postgres-user=<%= ENV["POSTGRES_USER"] %> \
  --from-literal=postgres-password=<%= ENV["POSTGRES_PASSWORD"] %>
