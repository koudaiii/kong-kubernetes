apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: kong
  labels:
    name: kong
spec:
  minReadySeconds: 30
  strategy:
    type: RollingUpdate
  replicas: 1
  template:
    metadata:
      name: kong
      labels:
        name: kong
    spec:
      containers:
      - image: koudaiii/kong
        name: kong
        ports:
          - containerPort: 8000
            name: http
          - containerPort: 8443
            name: https
          - containerPort: 8001
            name: admin
          - containerPort: 7946
            name: cluster
          - containerPort: 7946
            protocol: UDP
            name: cluster-udp
        env:
          - name: DATABASE
            valueFrom:
              secretKeyRef:
                name: kong
                key: database
          - name: POSTGRES_HOST
            valueFrom:
              secretKeyRef:
                name: kong
                key: postgres-host
          - name: POSTGRES_PORT
            valueFrom:
              secretKeyRef:
                name: kong
                key: postgres-port
          - name: POSTGRES_DATABASE
            valueFrom:
              secretKeyRef:
                name: kong
                key: postgres-database
          - name: POSTGRES_USER
            valueFrom:
              secretKeyRef:
                name: kong
                key: postgres-user
          - name: POSTGRES_PASSWORD
            valueFrom:
              secretKeyRef:
                name: kong
                key: postgres-password
